ALTER TABLE Dinero
ADD R1_3 INT DEFAULT 0;
ADD R1_2 INT DEFAULT 0;
ADD R1_1 INT DEFAULT 0;
ADD R1_0 INT DEFAULT 0;
ADD R2 INT DEFAULT 0;
ADD R3 INT DEFAULT 0;
ADD R4 INT DEFAULT 0;
ADD E1 INT DEFAULT 0;
ADD E2 INT DEFAULT 0;
ADD E3 INT DEFAULT 0;
ADD A INT DEFAULT 1;
ADD E4 INT DEFAULT 0;
ADD E5 INT DEFAULT 0;
ADD E6 INT DEFAULT 0;
ADD B INT DEFAULT 1;
ADD H1 INT DEFAULT 0;
ADD H2 INT DEFAULT 0;
ADD H3 INT DEFAULT 0;
ADD H4 INT DEFAULT 0;
ADD H5 INT DEFAULT 0;
ADD H6 INT DEFAULT 0;


-- Calcular y actualizar el indicador R1_3 en la base de datos Dinero
INSERT INTO Compra (Fecha, Empresa, Adj_Close, R2)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
    CASE 
        WHEN t1.RSI_SMA <= 25 
		THEN 1
        ELSE 0
    END AS R1_3
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  -- Comparando con el día anterior
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Calcular y actualizar el indicador R1_2 en la base de datos Dinero
INSERT INTO Compra (Fecha, Empresa, Adj_Close, R2)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
    CASE 
        WHEN t1.RSI_SMA <= 35 
		THEN 1
        ELSE 0
    END AS R1_3
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  -- Comparando con el día anterior
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Calcular y actualizar el indicador R1_1 en la base de datos Dinero
INSERT INTO Compra (Fecha, Empresa, Adj_Close, R2)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
    CASE 
        WHEN t1.RSI_SMA <= 45 
		THEN 1
        ELSE 0
    END AS R1_3
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  -- Comparando con el día anterior
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Calcular y actualizar el indicador R1_0 en la base de datos Dinero
INSERT INTO Compra (Fecha, Empresa, Adj_Close, R2)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
    CASE 
        WHEN t1.RSI_SMA > 45 
		THEN 1
        ELSE 0
    END AS R1_3
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  -- Comparando con el día anterior
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Calcular y actualizar el indicador R2 basado en la comparación de RSI_SMA de hoy y ayer
INSERT INTO Compra (Fecha, Empresa, Adj_Close, R2)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE 
        WHEN  t1.RSI_SMA > (SELECT RSI_SMA FROM Datos t2 WHERE t2.fecha = DATEADD(DAY, -1, t1.fecha) )
		THEN 1
        ELSE 0
    END AS R2
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha


-- Actualizar el valor de R3
INSERT INTO Compra (Fecha, Empresa, Adj_Close, R3)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE 
        WHEN  t1.RSI >  t1.RSI_SMA
		THEN 1
        ELSE 0
    END AS R3
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha


-- Actualizar el valor de R4
INSERT INTO Compra (Fecha, Empresa, Adj_Close, R4)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE 
        WHEN  t1.RSI_SMA > (SELECT RSI_SMA FROM Datos t2 WHERE t2.fecha = DATEADD(DAY, -1, t1.fecha) )
		THEN 1
        ELSE 0
    END AS R4
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Actualizar el valor de E1 de EMA_5

INSERT INTO Compra (Fecha, Empresa, Adj_Close, E1)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  (t1.EMA_5 - LAG(t1.EMA_5, 1) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha)) > (LAG(t1.EMA_5, 1) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha) - LAG(t1.EMA_5, 2) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha))
         AND (LAG(t1.EMA_5, 1) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha) - LAG(t1.EMA_5, 2) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha)) > (LAG(t1.EMA_5, 2) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha) - LAG(t1.EMA_5, 3) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha))
	THEN 1
        ELSE 0
    END AS E1
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Actualizar el valor de E2 de EMA_5
INSERT INTO Compra (Fecha, Empresa, Adj_Close, E2)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  t1.Adj_Close >  t1.EMA_5*A
        THEN 1
		ELSE 0
    END AS E2
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha


-- Actualizar el valor de E3 de EMA_5
INSERT INTO Compra (Fecha, Empresa, Adj_Close, E3)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  t1.EMA_5 > (SELECT EMA_5 FROM Datos t2 WHERE t2.Fecha = DATEADD(DAY, -1, t1.Fecha) AND t2.Empresa = t1.Empresa)
        THEN 1
		ELSE 0
    END AS E3
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha


-- Actualizar el valor de E4 de EMA_10

INSERT INTO Compra (Fecha, Empresa, Adj_Close, E4)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  (t1.EMA_10 - LAG(t1.EMA_10, 1) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha)) > (LAG(t1.EMA_10, 1) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha) - LAG(t1.EMA_10, 2) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha))
         AND (LAG(t1.EMA_10, 1) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha) - LAG(t1.EMA_10, 2) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha)) > (LAG(t1.EMA_10, 2) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha) - LAG(t1.EMA_10, 3) OVER (PARTITION BY t1.Empresa ORDER BY t1.Fecha))
	THEN 1
        ELSE 0
    END AS E4
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Actualizar el valor de E5 de EMA_10
INSERT INTO Compra (Fecha, Empresa, Adj_Close, E5)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  t1.Adj_Close >  t1.EMA_10*B
        THEN 1
		ELSE 0
    END AS E5
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha


-- Actualizar el valor de E6 de EMA_10
INSERT INTO Compra (Fecha, Empresa, Adj_Close, E6)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  t1.EMA_10 > (SELECT EMA_10 FROM Datos t2 WHERE t2.Fecha = DATEADD(DAY, -1, t1.Fecha) AND t2.Empresa = t1.Empresa)
        THEN 1
		ELSE 0
    END AS E6
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha


-- Actualizar el valor de H1 de HIST_1
INSERT INTO Compra (Fecha, Empresa, Adj_Close, H1)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  t1.HIST_1 > 0
        THEN 1
		ELSE 0
    END AS H1
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Actualizar el valor de H2 de HIST_1
INSERT INTO Compra (Fecha, Empresa, Adj_Close, H2)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  t1.HIST_1 > (SELECT HIST_1 FROM Datos t2 WHERE t2.Fecha = DATEADD(DAY, -1, t1.Fecha) AND t2.Empresa = t1.Empresa)
        THEN 1
		ELSE 0
    END AS H2
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Actualizar el valor de H3 de HIST_2
INSERT INTO Compra (Fecha, Empresa, Adj_Close, H3)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  t1.HIST_2 > 0
        THEN 1
		ELSE 0
    END AS H3
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Actualizar el valor de H4 de HIST_2
INSERT INTO Compra (Fecha, Empresa, Adj_Close, H4)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  t1.HIST_2 > (SELECT HIST_2 FROM Datos t2 WHERE t2.Fecha = DATEADD(DAY, -1, t1.Fecha) AND t2.Empresa = t1.Empresa)
        THEN 1
		ELSE 0
    END AS H4
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Actualizar el valor de H5 de HIST_3
INSERT INTO Compra (Fecha, Empresa, Adj_Close, H5)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  t1.HIST_3 > 0
        THEN 1
		ELSE 0
    END AS H5
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Actualizar el valor de H6 de HIST_3
INSERT INTO Compra (Fecha, Empresa, Adj_Close, H6)
SELECT 
    t1.Fecha,
    t1.Empresa,
    t1.Adj_Close,
	
    CASE
        WHEN  t1.HIST_3 > (SELECT HIST_3 FROM Datos t2 WHERE t2.Fecha = DATEADD(DAY, -1, t1.Fecha) AND t2.Empresa = t1.Empresa)
        THEN 1
		ELSE 0
    END AS H6
FROM 
    Datos t1  -- Tomando los datos desde la base de datos Datos
JOIN 
    Compra t2  
    ON t1.Empresa = t2.Empresa
    AND t1.Fecha =  t2.Fecha

-- Actualizar el valor de C1




